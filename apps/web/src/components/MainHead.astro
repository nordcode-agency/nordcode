---
import { getVersionedCSS } from '../config/staticCSS';
import '../styles/global.css';
import { ensureTrailingSlash } from '../utils/ensureTrailingSlash';

export interface Props {
    title: string;
    description: string;
    structuredData?: Record<string, unknown>[];
    ogImage?: string;
    canonical?: string;
    noIndex?: boolean;
}

const {
    title = 'Willkommen bei nordcode | nordcode',
    description =
        'Du bist auf der Suche nach einer kleinen, lokalen Agentur, die dir hilft, deine Onlinepr√§senz zu verbessern? Dann bist du bei uns genau richtig.',
    structuredData,
    canonical = ensureTrailingSlash(Astro.url.toString()),
    ogImage,
    // @todo: remove noIndex for clients
    noIndex = true,
} = Astro.props;

const baseUrl = Astro.site?.href.endsWith('/') ? Astro.site?.href.slice(0, -1) : Astro.site?.href;
const ogImagePath = ogImage ? `${baseUrl}${ogImage}` : `${baseUrl}/assets/images/og-image.jpg`;
const buildTime = new Date().toISOString();
---

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>

    <!-- Meta -->
    <meta name="description" content={description} />
    <meta name="theme-color" content="#012FFD" />
    <meta name="theme-color" content="#012FFD" media="(prefers-color-scheme: dark)" />
    <meta name="color-scheme" content="light dark">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:site_name" content="nordcode Immos" />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImagePath} />
    <meta property="og:image:url" content={ogImagePath} />
    <meta property="og:image:type" content="image/svg" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:locale" content="de-DE" />
    <meta property="og:updated_time" content={buildTime} />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonical} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />

    <link rel="sitemap" href="/sitemap-index.xml" />
    <meta property="twitter:image" content={ogImagePath} />

    {noIndex ? <meta name="robots" content="nofollow, noindex" /> : ''}

    <script>
    const colorScheme = localStorage?.getItem('color-scheme');
    if (colorScheme) {
        document.documentElement.setAttribute('data-theme', colorScheme);
    }
    </script>

    {
        structuredData?.map(data => (
            <script
                is:inline
                type="application/ld+json"
                set:html={JSON.stringify(data)}
            />
        ))
    }

    <!-- Links -->
    <link rel="canonical" href={canonical} />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />

    <link rel="manifest" href="/manifest.json">

    <link
        rel="preload"
        href="/assets/fonts/ArminGrotesk-Regular.woff2"
        as="font"
        type="font/woff2"
        crossorigin="anonymous"
    />
    <link
        rel="preload"
        href="/assets/fonts/ArminGrotesk-UltraBold.woff2"
        as="font"
        type="font/woff2"
        crossorigin="anonymous"
    />

    <link
        rel="preload"
        href="/assets/fonts/ArminGrotesk-SemiBold.woff2"
        as="font"
        type="font/woff2"
        crossorigin="anonymous"
    />

    <link rel="stylesheet" href="/assets/fonts/fonts.css" />
</head>
